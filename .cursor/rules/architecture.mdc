ğŸ“Œ MVVM + Layered Architectureã®æ›¸ãæ–¹ãƒ»è¨­è¨ˆåŸå‰‡
â‘  å˜æ–¹å‘ä¾å­˜ï¼ˆä¾å­˜æ–¹å‘ã®å¾¹åº•ï¼‰
ä¸Šä½å±¤ï¼ˆViewï¼‰ã‹ã‚‰ä¸‹ä½å±¤ï¼ˆInfrastructureï¼‰ã¸ä¸€æ–¹å‘ã«ã®ã¿ä¾å­˜ã™ã‚‹
ä¸‹ä½å±¤ã¯ä¸Šä½å±¤ã‚’çŸ¥ã‚‰ãªã„ï¼ˆViewã‚„ViewModelã‚’Domainã‚„Infrastructureã§å‚ç…§ã—ãªã„ï¼‰
pgsql
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
View â†’ ViewModel â†’ Application â†’ Domain â† Infrastructure
â‘¡ Viewå±¤ã®åŸå‰‡ï¼ˆå—å‹•çš„ã§ã‚ã‚‹ã“ã¨ï¼‰
Viewã«ã¯ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã»ã¼æ›¸ã‹ãšã€ViewModelãŒå…¬é–‹ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ã‘å–ã‚Šè¡¨ç¤ºã™ã‚‹
çŠ¶æ…‹ã®ç›£è¦–ã€ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ä»¥å¤–ã®ãƒ­ã‚¸ãƒƒã‚¯ã¯åŸå‰‡ç¦æ­¢
âœ… æ¨å¥¨ä¾‹ï¼š

typescript
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
// Viewã¯ViewModelã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã«å°‚å¿µã™ã‚‹
<Text>{viewModel.userName}</Text>
âŒ éæ¨å¥¨ä¾‹ï¼š

typescript
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
// Viewã«ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ãã“ã¨ã¯ç¦æ­¢
if (user.age > 18) {
  // ...
}
â‘¢ ViewModelå±¤ã®åŸå‰‡ï¼ˆçŠ¶æ…‹ç®¡ç†ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†ï¼‰
Viewã®è¡¨ç¤ºçŠ¶æ…‹ã‚’ä¿æŒã—ã€UIã«å¯¾ã—ã¦ãƒã‚¤ãƒ³ãƒ‰å¯èƒ½ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆã‚’æä¾›ã™ã‚‹
ViewModelã¯Applicationå±¤ã‚’åˆ©ç”¨ã—ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è‡ªèº«ã§æŠ±ãˆãªã„
âœ… æ¨å¥¨ä¾‹ï¼š

typescript
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
class UserViewModel {
  userName: string = '';

  constructor(private userUseCase: IUserUseCase) {}

  async loadUser(userId: string) {
    const user = await this.userUseCase.fetchUser(userId);
    this.userName = user.name;
  }
}
âŒ éæ¨å¥¨ä¾‹ï¼š

typescript
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
class UserViewModel {
  userName: string = '';

  async fetchUserFromApi(userId: string) {
    // ç›´æ¥Infrastructureå±¤ã‚’å‘¼ã¶ã®ã¯NG
    const response = await axios.get(`api/users/${userId}`);
    this.userName = response.data.name;
  }
}
â‘£ Applicationå±¤ï¼ˆãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼‰ã®åŸå‰‡
å…·ä½“çš„ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹
ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¨Infrastructureå±¤ã®æ©‹æ¸¡ã—å½¹
ViewModelã‚„Controllerãªã©ã«å¯¾ã—ã¦å…¬é–‹ã•ã‚Œã‚‹æ˜ç¢ºãªæ“ä½œã‚’æä¾›ã™ã‚‹
âœ… æ¨å¥¨ä¾‹ï¼š

typescript
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
class UserUseCase implements IUserUseCase {
  constructor(private userRepository: IUserRepository) {}

  async fetchUser(userId: string): Promise<User> {
    return await this.userRepository.getById(userId);
  }
}
âŒ éæ¨å¥¨ä¾‹ï¼š

typescript
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
// Infrastructureå±¤ã®çŸ¥è­˜ã‚„å…·ä½“çš„å®Ÿè£…ã‚’Applicationå±¤ã§æ„è­˜ã—ã™ãã‚‹ã“ã¨ã¯NG
class UserUseCase {
  async fetchUser(userId: string): Promise<User> {
    return await axios.get(`/user/${userId}`); // Infrastructureã®ç›´æ¥åˆ©ç”¨ã¯NG
  }
}
â‘¤ Domainå±¤ã®åŸå‰‡ï¼ˆãƒ“ã‚¸ãƒã‚¹ä¸­å¿ƒã®è¨­è¨ˆï¼‰
ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ï¼ˆEntityãƒ»Value Objectï¼‰ã«ã¯ç´”ç²‹ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ã¿è¨˜è¿°
æŠ€è¡“çš„å®Ÿè£…ï¼ˆæ°¸ç¶šåŒ–ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãªã©ï¼‰ã¯å«ã‚ãªã„
âœ… æ¨å¥¨ä¾‹ï¼š

typescript
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
// ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ä¾‹ï¼ˆEntityï¼‰
class User {
  constructor(public readonly id: string, public readonly name: string) {}

  isAdult(age: number): boolean {
    return age >= 18;
  }
}
âŒ éæ¨å¥¨ä¾‹ï¼š

typescript
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
// ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«Infrastructureã®çŸ¥è­˜ã¯å…¥ã‚Œãªã„
class User {
  saveToDb() { /* NG */ }
}
â‘¥ Infrastructureå±¤ã®åŸå‰‡ï¼ˆãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã®æŠ½è±¡åŒ–ï¼‰
DBã‚„å¤–éƒ¨APIã¨ã®é€šä¿¡ã¯ã“ã“ã§è¡Œã„ã€Repositoryãƒ‘ã‚¿ãƒ¼ãƒ³ç­‰ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æŠ½è±¡åŒ–ã™ã‚‹
âœ… æ¨å¥¨ä¾‹ï¼š

typescript
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
class UserRepository implements IUserRepository {
  async getById(id: string): Promise<User> {
    const response = await axios.get(`api/users/${id}`);
    return new User(response.data.id, response.data.name);
  }
}
ğŸ“Œ ãã®ä»–ã®æ¨å¥¨è¨­è¨ˆåŸå‰‡
åŸå‰‡	èª¬æ˜
SOLIDåŸå‰‡	è²¬å‹™ã®å˜ä¸€æ€§ã€ã‚ªãƒ¼ãƒ—ãƒ³ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰ã®åŸå‰‡ã‚’å¾¹åº•
DRYåŸå‰‡	åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¤‡æ•°ç®‡æ‰€ã«æ›¸ã‹ãªã„
DIï¼ˆä¾å­˜æ€§æ³¨å…¥ï¼‰	ä¾å­˜æ€§ã®ç®¡ç†ã«DIã‚’ä½¿ã„ã€ç–çµåˆåŒ–
ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°	Viewã¨ViewModelé–“ã®ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ã‚’æ˜ç¤ºçš„ã«è¡Œã†
âœ… ç†æƒ³çš„ãªä¾å­˜æ–¹å‘ï¼ˆã¾ã¨ã‚ï¼‰
pgsql
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
View â† ViewModel â† Application â† Domain â†’ Infrastructure
Domainã¯ä¸­å¿ƒã§ã€Infrastructureã‚’æŠ½è±¡çš„ã«å‚ç…§
Applicationå±¤ãŒDomainã®æ“ä½œã‚’æ‹…ã†
ViewModelã¯ApplicationçµŒç”±ã§ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å‘¼ã³å‡ºã™
Viewã¯ViewModelã‚’ç›£è¦–ãƒ»æ“ä½œ
ã“ã®ã‚ˆã†ã«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ˜ç¢ºã«åˆ†ã‘ã€è²¬å‹™ã‚’é©åˆ‡ã«åˆ†æ‹…ã™ã‚‹ã“ã¨ã§ã€ä¿å®ˆæ€§ãƒ»ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ãŒå‘ä¸Šã—ã€æ‹¡å¼µã‚„å¤‰æ›´ã«ã‚‚å¼·ã„è¨­è¨ˆãŒå®Ÿç¾ã—ã¾ã™ã€‚








